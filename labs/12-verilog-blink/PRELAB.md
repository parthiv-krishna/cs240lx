# Prelab

In the next two labs you'll learn a bit of SystemVerilog: enough to make some
basic arithmetic and sequential circuits (lab 1), and a UART
receiver/transmitter (lab 2).

We'll be using the UPduino FPGA board and open-source tools for simulation and
synthesis.

In the first lab we'll experiment with making basic circuits. Please look
through the following resource to get started learning SystemVerilog:

* [docs/sv_guide_240lx.pdf](docs/sv_guide_240lx.pdf)

The first lab will be about applying the concepts from sections 2, 3, and 4.
The second lab will additionally involve section 5 (finite state machines) to
build a hardware UART module.

## Toolchain installation

The following open-source tools are needed for UPduino FPGA development:

* Yosys (synthesis engine)
* NextPNR (place and route tool)
* Icestorm (bitstream generation for ice40 FPGAs)
* Verilator (simulator)
* GTKWave (for displaying waveforms generated by Verilator, optional)

Installing all these tools is a bit of a pain.

### Pre-built tools

For Ubuntu:

Download the verilator and ice40-dev deb files from the Github releases tab.

```
sudo apt install ./verilator-4.204-amd64.deb
sudo apt install ./ice40-dev-amd64.deb
```

If you are not on Ubuntu we have prebuilt binaries for NextPNR and ice40 tools in `ice40-tools-linux.tar.gz`, but you may need to install additional dependencies (`libftdi` and `libboost`).

For Mac:

```
brew install yosys
brew install verilator
```

Build the ice40 tools and NextPNR from source, or use prebuilt binaries (coming soon).

### Building from source

Scripts for building everything from source are included in the
`install-scripts` directory. The commands are replicated here as well.

#### Yosys

```
git clone https://github.com/YosysHQ/yosys.git yosys
cd yosys
make
sudo make install
```

#### Icestorm

```
git clone https://github.com/YosysHQ/icestorm.git icestorm
cd icestorm
make
sudo make install
```

#### NextPNR (ice40)

Dependencies for mac:

```
brew install libftdi boost eigen cmake
```

NOTE: you need icestorm to build nextpnr.

```
git clone https://github.com/YosysHQ/nextpnr nextpnr-ice40
cd nextpnr-ice40
cmake -DARCH=ice40 -DCMAKE_INSTALL_PREFIX=/usr/local .
make
sudo make install
```

#### Verilator

```
git clone https://github.com/verilator/verilator
cd verilator
git checkout stable
autoconf
./configure
make
sudo make install
```

### GTKWave (optional)

```
sudo apt install gtkwave
```

Website: http://gtkwave.sourceforge.net/
